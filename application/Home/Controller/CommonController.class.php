<?phpnamespace Home\Controller;use Think\Controller;/** * todo 删除已经分离的方法 * get* * manage* */class CommonController extends Controller { public function _initialize() {        header('Access-Control-Allow-Origin: *');          //不需要验证签名的方法        $no_auth = array('upload');         if (!in_array(ACTION_NAME, $no_auth)) {            $this->checkSign();        }                  }    protected function getSign($data) {        unset($data['sign']);        ksort($data);        foreach ($data as $k => $v) {//            $v = urlencode($v);            $buff .= $k . "=" . $v . "&";        }        return md5($buff . API_TOKEN);    }      public function success($msg = '') {               $data['msg'] = $msg;        $data['status'] = 1;        $this->ajaxReturn($data);        exit;    }    public function error($msg = '') {        $data['msg'] = $msg;        $data['status'] = 0;        $this->ajaxReturn($data);        exit;    }    /**     * 参数按键值排序连接md5     * 验证签名     */    protected function checkSign() {        $data = $_POST;        if (!isset($data['sign'])) {            //缺少签名            $this->error('缺少参数sign');        }        $localsign = $this->getSign($data);        if ($localsign != $data['sign']) {            $getmd5 = $data['sign'];            unset($data['sign']);            ksort($data);            foreach ($data as $k => $v) {//                $v = urlencode($v);                $buff .= $k . "=" . $v . "&";            }            $this->error('签名错误:' . $buff . API_TOKEN . 'md5:' . $localsign . 'getmd5' . $getmd5);        }    }}